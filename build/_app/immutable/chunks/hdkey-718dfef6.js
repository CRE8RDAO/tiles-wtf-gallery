import{s as g,H as U,g as E,K as O}from"./web3-db635edc.js";import{b as w}from"./index-6dba30c8.js";function C(e,i){return i.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(t){if(t!=="default"&&!(t in e)){var c=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,c.get?c:{enumerable:!0,get:function(){return r[t]}})}})}),Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var l=w,P=g.exports.Buffer,j=function(e){function i(n){var o=e(n);return l.encode(P.concat([n,o],n.length+4))}function r(n){var o=n.slice(0,-4),p=n.slice(-4),h=e(o);if(!(p[0]^h[0]|p[1]^h[1]|p[2]^h[2]|p[3]^h[3]))return o}function t(n){var o=l.decodeUnsafe(n);if(!!o)return r(o)}function c(n){var o=l.decode(n),p=r(o);if(!p)throw new Error("Invalid checksum");return p}return{encode:i,decode:c,decodeUnsafe:t}},m=U,k=j;function S(e){var i=m("sha256").update(e).digest();return m("sha256").update(i).digest()}var A=k(S),u=E,s=g.exports.Buffer,y=E,b=A,d=O,H=s.from("Bitcoin seed","utf8"),v=2147483648,D=78,_={private:76066276,public:76067358};function a(e){this.versions=e||_,this.depth=0,this.index=0,this._privateKey=null,this._publicKey=null,this.chainCode=null,this._fingerprint=0,this.parentFingerprint=0}Object.defineProperty(a.prototype,"fingerprint",{get:function(){return this._fingerprint}});Object.defineProperty(a.prototype,"identifier",{get:function(){return this._identifier}});Object.defineProperty(a.prototype,"pubKeyHash",{get:function(){return this.identifier}});Object.defineProperty(a.prototype,"privateKey",{get:function(){return this._privateKey},set:function(e){u.equal(e.length,32,"Private key must be 32 bytes."),u(d.privateKeyVerify(e)===!0,"Invalid private key"),this._privateKey=e,this._publicKey=s.from(d.publicKeyCreate(e,!0)),this._identifier=B(this.publicKey),this._fingerprint=this._identifier.slice(0,4).readUInt32BE(0)}});Object.defineProperty(a.prototype,"publicKey",{get:function(){return this._publicKey},set:function(e){u(e.length===33||e.length===65,"Public key must be 33 or 65 bytes."),u(d.publicKeyVerify(e)===!0,"Invalid public key"),this._publicKey=s.from(d.publicKeyConvert(e,!0)),this._identifier=B(this.publicKey),this._fingerprint=this._identifier.slice(0,4).readUInt32BE(0),this._privateKey=null}});Object.defineProperty(a.prototype,"privateExtendedKey",{get:function(){return this._privateKey?b.encode(I(this,this.versions.private,s.concat([s.alloc(1,0),this.privateKey]))):null}});Object.defineProperty(a.prototype,"publicExtendedKey",{get:function(){return b.encode(I(this,this.versions.public,this.publicKey))}});a.prototype.derive=function(e){if(e==="m"||e==="M"||e==="m'"||e==="M'")return this;var i=e.split("/"),r=this;return i.forEach(function(t,c){if(c===0){u(/^[mM]{1}/.test(t),'Path must start with "m" or "M"');return}var n=t.length>1&&t[t.length-1]==="'",o=parseInt(t,10);u(o<v,"Invalid index"),n&&(o+=v),r=r.deriveChild(o)}),r};a.prototype.deriveChild=function(e){var i=e>=v,r=s.allocUnsafe(4);r.writeUInt32BE(e,0);var t;if(i){u(this.privateKey,"Could not derive hardened child key");var c=this.privateKey,n=s.alloc(1,0);c=s.concat([n,c]),t=s.concat([c,r])}else t=s.concat([this.publicKey,r]);var o=y.createHmac("sha512",this.chainCode).update(t).digest(),p=o.slice(0,32),h=o.slice(32),f=new a(this.versions);if(this.privateKey)try{f.privateKey=s.from(d.privateKeyTweakAdd(s.from(this.privateKey),p))}catch{return this.deriveChild(e+1)}else try{f.publicKey=s.from(d.publicKeyTweakAdd(s.from(this.publicKey),p,!0))}catch{return this.deriveChild(e+1)}return f.chainCode=h,f.depth=this.depth+1,f.parentFingerprint=this.fingerprint,f.index=e,f};a.prototype.sign=function(e){return s.from(d.ecdsaSign(e,this.privateKey).signature)};a.prototype.verify=function(e,i){return d.ecdsaVerify(Uint8Array.from(i),Uint8Array.from(e),Uint8Array.from(this.publicKey))};a.prototype.wipePrivateData=function(){return this._privateKey&&y.randomBytes(this._privateKey.length).copy(this._privateKey),this._privateKey=null,this};a.prototype.toJSON=function(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}};a.fromMasterSeed=function(e,i){var r=y.createHmac("sha512",H).update(e).digest(),t=r.slice(0,32),c=r.slice(32),n=new a(i);return n.chainCode=c,n.privateKey=t,n};a.fromExtendedKey=function(e,i){i=i||_;var r=new a(i),t=b.decode(e),c=t.readUInt32BE(0);u(c===i.private||c===i.public,"Version mismatch: does not match private or public"),r.depth=t.readUInt8(4),r.parentFingerprint=t.readUInt32BE(5),r.index=t.readUInt32BE(9),r.chainCode=t.slice(13,45);var n=t.slice(45);return n.readUInt8(0)===0?(u(c===i.private,"Version mismatch: version does not match private"),r.privateKey=n.slice(1)):(u(c===i.public,"Version mismatch: version does not match public"),r.publicKey=n),r};a.fromJSON=function(e){return a.fromExtendedKey(e.xpriv)};function I(e,i,r){var t=s.allocUnsafe(D);t.writeUInt32BE(i,0),t.writeUInt8(e.depth,4);var c=e.depth?e.parentFingerprint:0;return t.writeUInt32BE(c,5),t.writeUInt32BE(e.index,9),e.chainCode.copy(t,13),r.copy(t,45),t}function B(e){var i=y.createHash("sha256").update(e).digest();return y.createHash("ripemd160").update(i).digest()}a.HARDENED_OFFSET=v;var K=a,T=C({__proto__:null,default:K},[K]);export{T as h};

import{c as U}from"./index-46a986ed.js";import{E as L}from"./web3-db635edc.js";import"./preload-helper-f8a04cdf.js";import"./index-e63e67ba.js";var i=i||{},b=i;i.EXTENSION_ID="kmendfapggjehodndflmmgagdbamhnfd";i.MessageTypes={U2F_REGISTER_REQUEST:"u2f_register_request",U2F_SIGN_REQUEST:"u2f_sign_request",U2F_REGISTER_RESPONSE:"u2f_register_response",U2F_SIGN_RESPONSE:"u2f_sign_response"};i.ErrorCodes={OK:0,OTHER_ERROR:1,BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5};i.Request;i.Response;i.Error;i.SignRequest;i.SignResponse;i.RegisterRequest;i.RegisterResponse;i.disconnect=function(){i.port_&&i.port_.port_&&(i.port_.port_.disconnect(),i.port_=null)};i.getMessagePort=function(e){if(typeof chrome!="undefined"&&chrome.runtime){var t={type:i.MessageTypes.U2F_SIGN_REQUEST,signRequests:[]};chrome.runtime.sendMessage(i.EXTENSION_ID,t,function(){chrome.runtime.lastError?i.getIframePort_(e):i.getChromeRuntimePort_(e)})}else i.getIframePort_(e)};i.getChromeRuntimePort_=function(e){var t=chrome.runtime.connect(i.EXTENSION_ID,{includeTlsChannelId:!0});setTimeout(function(){e(null,new i.WrappedChromeRuntimePort_(t))},0)};i.WrappedChromeRuntimePort_=function(e){this.port_=e};i.WrappedChromeRuntimePort_.prototype.postMessage=function(e){this.port_.postMessage(e)};i.WrappedChromeRuntimePort_.prototype.addEventListener=function(e,t){var n=e.toLowerCase();n=="message"||n=="onmessage"?this.port_.onMessage.addListener(function(o){t({data:o})}):console.error("WrappedChromeRuntimePort only supports onMessage")};i.getIframePort_=function(e){var t="chrome-extension://"+i.EXTENSION_ID,n=document.createElement("iframe");n.src=t+"/u2f-comms.html",n.setAttribute("style","display:none"),document.body.appendChild(n);var o=!1,a=new MessageChannel,s=function(u){u.data=="ready"?(a.port1.removeEventListener("message",s),o||(o=!0,e(null,a.port1))):console.error('First event on iframe port was not "ready"')};a.port1.addEventListener("message",s),a.port1.start(),n.addEventListener("load",function(){n.contentWindow.postMessage("init",t,[a.port2])}),setTimeout(function(){o||(o=!0,e(new Error("IFrame extension not supported")))},200)};i.EXTENSION_TIMEOUT_SEC=30;i.port_=null;i.waitingForPort_=[];i.reqCounter_=0;i.callbackMap_={};i.getPortSingleton_=function(e){i.port_?e(null,i.port_):(i.waitingForPort_.length==0&&i.getMessagePort(function(t,n){for(t||(i.port_=n,i.port_.addEventListener("message",i.responseHandler_));i.waitingForPort_.length;)i.waitingForPort_.shift()(t,n)}),i.waitingForPort_.push(e))};i.responseHandler_=function(e){var t=e.data,n=t.requestId;if(!n||!i.callbackMap_[n]){console.error("Unknown or missing requestId in response.");return}var o=i.callbackMap_[n];delete i.callbackMap_[n],o(null,t.responseData)};i.isSupported=function(e){i.getPortSingleton_(function(t,n){e(!t)})};i.sign=function(e,t,n){i.getPortSingleton_(function(o,a){if(o)return t(o);var s=++i.reqCounter_;i.callbackMap_[s]=t;var u={type:i.MessageTypes.U2F_SIGN_REQUEST,signRequests:e,timeoutSeconds:typeof n!="undefined"?n:i.EXTENSION_TIMEOUT_SEC,requestId:s};a.postMessage(u)})};i.register=function(e,t,n,o){i.getPortSingleton_(function(a,s){if(a)return n(a);var u=++i.reqCounter_;i.callbackMap_[u]=n;var c={type:i.MessageTypes.U2F_REGISTER_REQUEST,signRequests:t,registerRequests:e,timeoutSeconds:typeof o!="undefined"?o:i.EXTENSION_TIMEOUT_SEC,requestId:u};s.postMessage(c)})};var B=g,y=b,O=typeof navigator!="undefined"&&!!navigator.userAgent,G=O&&navigator.userAgent.match(/Safari\//)&&!navigator.userAgent.match(/Chrome\//),k=O&&navigator.userAgent.match(/Edge\/1[2345]/),C=null;function I(e){return C||(C=new e(function(t,n){function o(){t({u2f:null,native:!0})}if(!O||G)return o();var a=typeof window.u2f!="undefined"&&typeof window.u2f.sign=="function";if(a&&t({u2f:window.u2f,native:!0}),k||location.protocol==="http:"||typeof MessageChannel=="undefined")return o();y.isSupported(function(s){s?t({u2f:y,native:!1}):o()})})),C}function g(e){return{isSupported:H.bind(e),ensureSupport:q.bind(e),register:K.bind(e),sign:W.bind(e),ErrorCodes:g.ErrorCodes,ErrorNames:g.ErrorNames}}g.ErrorCodes={CANCELLED:-1,OK:0,OTHER_ERROR:1,BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5};g.ErrorNames={"-1":"CANCELLED",0:"OK",1:"OTHER_ERROR",2:"BAD_REQUEST",3:"CONFIGURATION_UNSUPPORTED",4:"DEVICE_INELIGIBLE",5:"TIMEOUT"};function T(e,t){var n=t!=null?t.errorCode:1,o=g.ErrorNames[""+n],a=new Error(e);return a.metaData={type:o,code:n},a}function F(e,t){var n={};return n.promise=new e(function(o,a){n.resolve=o,n.reject=a,t.then(o,a)}),n.promise.cancel=function(o,a){I(e).then(function(s){a&&!s.native&&s.u2f.disconnect(),n.reject(T(o,{errorCode:-1}))})},n}function H(){var e=this;return I(e).then(function(t){return!!t.u2f})}function w(e){if(!e.u2f)throw location.protocol==="http:"?new Error("U2F isn't supported over http, only https"):new Error("U2F not supported")}function q(){var e=this;return I(e).then(w)}function K(e,t,n){var o=this;return Array.isArray(e)||(e=[e]),typeof t=="number"&&typeof n=="undefined"&&(n=t,t=null),t||(t=[]),F(o,I(o).then(function(a){w(a);var s=a.native,u=a.u2f;return new o(function(c,d){function l(p){p.errorCode?d(T("Registration failed",p)):(delete p.errorCode,c(p))}function f(p,h){p?d(p):h.errorCode?d(T("Registration failed",h)):c(h)}if(s){var A=e[0].appId;u.register(A,e,t,l,n)}else u.register(e,t,f,n)})})).promise}function W(e,t){var n=this;return Array.isArray(e)||(e=[e]),F(n,I(n).then(function(o){w(o);var a=o.native,s=o.u2f;return new n(function(u,c){function d(p){p.errorCode?c(T("Sign failed",p)):(delete p.errorCode,u(p))}function l(p,h){p?c(p):h.errorCode?c(T("Sign failed",h)):u(h)}if(a){var f=e[0].appId,A=e[0].challenge;s.sign(f,A,e,d,t)}else s.sign(e,l,t)})})).promise}function S(e){g[e]=function(){if(!U.Promise)throw new Error("The platform doesn't natively support promises");var t=[].slice.call(arguments);return g(U.Promise)[e].apply(null,t)}}S("isSupported");S("ensureSupport");S("register");S("sign");var N=B,r=function(e){var t=function(o,a){Object.assign(this,a),this.name=e,this.message=o||e,this.stack=new Error().stack};return t.prototype=new Error,t};r("AccountNameRequired");r("AccountNotSupported");r("AmountRequired");r("BluetoothRequired");r("BtcUnmatchedApp");r("CantOpenDevice");r("CashAddrNotSupported");r("CurrencyNotSupported");r("DeviceAppVerifyNotSupported");r("DeviceGenuineSocketEarlyClose");r("DeviceNotGenuine");r("DeviceOnDashboardExpected");r("DeviceOnDashboardUnexpected");r("DeviceInOSUExpected");r("DeviceHalted");r("DeviceNameInvalid");r("DeviceSocketFail");r("DeviceSocketNoBulkStatus");r("DisconnectedDevice");r("DisconnectedDeviceDuringOperation");r("EnpointConfig");r("EthAppPleaseEnableContractData");r("FeeEstimationFailed");r("FirmwareNotRecognized");r("HardResetFail");r("InvalidXRPTag");r("InvalidAddress");r("InvalidAddressBecauseDestinationIsAlsoSource");r("LatestMCUInstalledError");r("UnknownMCU");r("LedgerAPIError");r("LedgerAPIErrorWithMessage");r("LedgerAPINotAvailable");r("ManagerAppAlreadyInstalled");r("ManagerAppRelyOnBTC");r("ManagerAppDepInstallRequired");r("ManagerAppDepUninstallRequired");r("ManagerDeviceLocked");r("ManagerFirmwareNotEnoughSpace");r("ManagerNotEnoughSpace");r("ManagerUninstallBTCDep");r("NetworkDown");r("NoAddressesFound");r("NotEnoughBalance");r("NotEnoughBalanceToDelegate");r("NotEnoughBalanceInParentAccount");r("NotEnoughSpendableBalance");r("NotEnoughBalanceBecauseDestinationNotCreated");r("NoAccessToCamera");r("NotEnoughGas");r("NotSupportedLegacyAddress");r("GasLessThanEstimate");r("PasswordsDontMatch");r("PasswordIncorrect");r("RecommendSubAccountsToEmpty");r("RecommendUndelegation");r("TimeoutTagged");r("UnexpectedBootloader");r("MCUNotGenuineToDashboard");r("RecipientRequired");r("UnavailableTezosOriginatedAccountReceive");r("UnavailableTezosOriginatedAccountSend");r("UpdateFetchFileFail");r("UpdateIncorrectHash");r("UpdateIncorrectSig");r("UpdateYourApp");r("UserRefusedDeviceNameChange");r("UserRefusedAddress");r("UserRefusedFirmwareUpdate");r("UserRefusedAllowManager");r("UserRefusedOnDevice");r("TransportOpenUserCancelled");r("TransportInterfaceNotAvailable");var V=r("TransportRaceCondition");r("TransportWebUSBGestureRequired");r("DeviceShouldStayInApp");r("WebsocketConnectionError");r("WebsocketConnectionFailed");r("WrongDeviceForAccount");r("WrongAppForCurrency");r("ETHAddressNonEIP");r("CantScanQRCode");r("FeeNotLoaded");r("FeeRequired");r("FeeTooHigh");r("SyncError");r("PairingFailed");r("GenuineCheckFailed");r("LedgerAPI4xx");r("LedgerAPI5xx");r("FirmwareOrAppUpdateRequired");r("NoDBPathGiven");r("DBWrongPassword");r("DBNotReset");function m(e,t){this.name="TransportError",this.message=e,this.stack=new Error().stack,this.id=t}m.prototype=new Error;var D={PIN_REMAINING_ATTEMPTS:25536,INCORRECT_LENGTH:26368,MISSING_CRITICAL_PARAMETER:26624,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,SECURITY_STATUS_NOT_SATISFIED:27010,CONDITIONS_OF_USE_NOT_SATISFIED:27013,INCORRECT_DATA:27264,NOT_ENOUGH_MEMORY_SPACE:27268,REFERENCED_DATA_NOT_FOUND:27272,FILE_ALREADY_EXISTS:27273,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,CLA_NOT_SUPPORTED:28160,TECHNICAL_PROBLEM:28416,OK:36864,MEMORY_PROBLEM:37440,NO_EF_SELECTED:37888,INVALID_OFFSET:37890,FILE_NOT_FOUND:37892,INCONSISTENT_FILE:37896,ALGORITHM_NOT_SUPPORTED:38020,INVALID_KCV:38021,CODE_NOT_INITIALIZED:38914,ACCESS_CONDITION_NOT_FULFILLED:38916,CONTRADICTION_SECRET_CODE_STATUS:38920,CONTRADICTION_INVALIDATION:38928,CODE_BLOCKED:38976,MAX_VALUE_REACHED:38992,GP_AUTH_FAILED:25344,LICENSING:28482,HALTED:28586};function X(e){switch(e){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received"}if(28416<=e&&e<=28671)return"Internal error, please report"}function M(e){this.name="TransportStatusError";var t=Object.keys(D).find(function(a){return D[a]===e})||"UNKNOWN_ERROR",n=X(e)||t,o=e.toString(16);this.message="Ledger device: "+n+" (0x"+o+")",this.stack=new Error().stack,this.statusCode=e,this.statusText=t}M.prototype=new Error;class _{constructor(){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new L,this.send=async(t,n,o,a,s=Buffer.alloc(0),u=[D.OK])=>{if(s.length>=256)throw new m("data.length exceed 256 bytes limit. Got: "+s.length,"DataLengthTooBig");const c=await this.exchange(Buffer.concat([Buffer.from([t,n,o,a]),Buffer.from([s.length]),s])),d=c.readUInt16BE(c.length-2);if(!u.some(l=>l===d))throw new M(d);return c},this.exchangeBusyPromise=void 0,this.exchangeAtomicImpl=async t=>{if(this.exchangeBusyPromise)throw new V("An action was already pending on the Ledger device. Please deny or reconnect.");let n;const o=new Promise(u=>{n=u});this.exchangeBusyPromise=o;let a=!1;const s=setTimeout(()=>{a=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const u=await t();return a&&this.emit("responsive"),u}finally{clearTimeout(s),n&&n(),this.exchangeBusyPromise=null}},this._appAPIlock=null}exchange(t){throw new Error("exchange not implemented")}setScrambleKey(t){}close(){return Promise.resolve()}on(t,n){this._events.on(t,n)}off(t,n){this._events.removeListener(t,n)}emit(t,...n){this._events.emit(t,...n)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(t){this.exchangeTimeout=t}setExchangeUnresponsiveTimeout(t){this.unresponsiveTimeout=t}static create(t=3e3,n){return new Promise((o,a)=>{let s=!1;const u=this.listen({next:d=>{s=!0,u&&u.unsubscribe(),c&&clearTimeout(c),this.open(d.descriptor,t).then(o,a)},error:d=>{c&&clearTimeout(c),a(d)},complete:()=>{c&&clearTimeout(c),s||a(new m(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),c=n?setTimeout(()=>{u.unsubscribe(),a(new m(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},n):null})}decorateAppAPIMethods(t,n,o){for(let a of n)t[a]=this.decorateAppAPIMethod(a,t[a],t,o)}decorateAppAPIMethod(t,n,o,a){return async(...s)=>{const{_appAPIlock:u}=this;if(u)return Promise.reject(new m("Ledger Device is busy (lock "+u+")","TransportLocked"));try{return this._appAPIlock=t,this.setScrambleKey(a),await n.apply(o,s)}finally{this._appAPIlock=null}}}}_.isSupported=void 0;_.list=void 0;_.listen=void 0;_.open=void 0;_.ErrorMessage_ListenTimeout="No Ledger device found (timeout)";_.ErrorMessage_NoDeviceFound="No Ledger device found";let Q=0;const E=[],P=(e,t,n)=>{const o={type:e,id:String(++Q),date:new Date};t&&(o.message=t),n&&(o.data=n),z(o)},Y=e=>(E.push(e),()=>{const t=E.indexOf(e);t!==-1&&(E[t]=E[E.length-1],E.pop())});function z(e){for(let t=0;t<E.length;t++)try{E[t](e)}catch(n){console.error(n)}}typeof window!="undefined"&&(window.__ledgerLogsListen=Y);function j(e,t,n){const o=new m(t,n);return o.originalError=e,o}function $(e,t){const n=Buffer.alloc(e.length);for(let o=0;o<e.length;o++)n[o]=e[o]^t[o%t.length];return n}const x=e=>e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),Z=e=>e.replace(/-/g,"+").replace(/_/g,"/")+"==".substring(0,3*e.length%4);function J(e,t,n,o){const a=$(e,n),s=Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),u={version:"U2F_V2",keyHandle:x(a.toString("base64")),challenge:x(s.toString("base64")),appId:location.origin};return P("apdu","=> "+e.toString("hex")),N.sign(u,t/1e3).then(c=>{const{signatureData:d}=c;if(typeof d=="string"){const l=Buffer.from(Z(d),"base64");let f;return o?f=l.slice(5):f=l,P("apdu","<= "+f.toString("hex")),f}else throw c})}let R=[];function ee(){R.forEach(e=>e.emit("disconnect")),R=[]}function te(e){return e.metaData.code===5}class v extends _{static async open(t,n=5e3){return new v}constructor(){super(),this.scrambleKey=void 0,this.unwrap=!0,R.push(this)}async exchange(t){try{return await J(t,this.exchangeTimeout,this.scrambleKey,this.unwrap)}catch(n){throw typeof n.metaData=="object"?(te(n)&&ee(),j(n,"Failed to sign with Ledger device: U2F "+n.metaData.type,"U2F_"+n.metaData.code)):n}}setScrambleKey(t){this.scrambleKey=Buffer.from(t,"ascii")}setUnwrap(t){this.unwrap=t}close(){return Promise.resolve()}}v.isSupported=N.isSupported;v.list=()=>N.isSupported().then(e=>e?[null]:[]);v.listen=e=>{let t=!1;return N.isSupported().then(n=>{t||(n?(e.next({type:"add",descriptor:null}),e.complete()):e.error(new m("U2F browser support is needed for Ledger. Please use Chrome, Opera or Firefox with a U2F extension. Also make sure you're on an HTTPS connection","U2FNotSupported")))}),{unsubscribe:()=>{t=!0}}};export{v as default};
